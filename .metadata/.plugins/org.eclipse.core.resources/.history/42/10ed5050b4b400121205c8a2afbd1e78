/*
 * OuterLoop.c
 *
 *  Created on: Apr 30, 2013
 *      Author: Daniel
 */

#include "Functions.h"


bool start_outer = true;
double tita, titadot, x, xdot, theta, tita_neg = 0;
double VREF, Force, ws, wl, mju, Fsw, Fl, ANGV, e1, e2, Torque = 0;
double xd, O, f1, f2, d2, d1, gwn, phiwn, DV, row, a, E, Ed =0;
double tita_hist[3] = {0};
double x_hist[3] = {0};
int PWM_value = 0;

interrupt void Outer_Loop(void)
{
	int i = 0;

	if(start_outer == true)
	{
		for(i=0;i<4;i++)
		{
			tita_hist[i] = 0;
			x_hist[i] = 0;
		}
		EQep1Regs.QEPCTL.bit.SWI=1;
		EQep1Regs.QEPCTL.bit.SWI=0;
	}
	else
	{
		//Calculate algorithm
		sensorData();



		//output PWM

		PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; // Acknowledge interrupt to PIE
		return;
	}

}


