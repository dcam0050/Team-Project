/*
 * OuterLoop.c
 *
 *  Created on: Apr 30, 2013
 *      Author: Daniel
 */

#include "Functions.h"

Uint32 Abs_Enc = 0;
POSSPEED qep_posspeed;

interrupt void Outer_Loop(void)
{
	EPwm2Regs.ETCLR.bit.INT = 1;	//Clear Interrupt in timer
	//Read data from absolute encoder
	GpioG1DataRegs.GPADAT.bit.GPIO6 = 0; //Latch Output
	Abs_Enc = (GpioG1DataRegs.GPADAT.all & 0x000FFF00) << 8;
	GpioG1DataRegs.GPADAT.bit.GPIO6 = 1; //UnLatch Output

	//Read data from relative encoder
	qep_posspeed.calc(&qep_posspeed);

	//Calculate algorithm

	//output PWM

	 PieCtrlRegs.PIEACK.all = PIEACK_GROUP3; // Acknowledge interrupt to PIE
	 return;

}


